---
postfix::service_name: 'postfix'
postfix::service_enable: true
postfix::service_ensure: 'running'
postfix::service_manage: true

postfix::configuration_directory: '/etc/postfix'
postfix::db_files:
  - sender_canonical
  - sender-mx-access
  - sender-ns-access
  - virtual
  - virtual_alias
  - client-access
  - helo-access

postfix::config_files:
  - 'dynamicmaps.cf'
  - 'master.cf'

postfix::access_files:
  - 'postscreen_access.cidr'
  - 'mime_header_checks'
  - 'header_checks'
  - 'filtered_domains'

postfix::postfix_files_directory: 'postfix-files.d/'
postfix::postfix_files_content:
  - 'doc.files'
  - 'ldap.files'
  - 'pcre.files'
  - 'sqlite.files'

postfix::sasl_files_directory: 'sasl/'
postfix::sasl_files:
  - 'smtp.conf'
  - 'smtpd.conf'

postfix::enable_debug: true

postfix::enable_server_ssl: true
postfix::smtpd_tls_cert_file: '/var/lib/dehydrated/certs/architux.com/cert.pem'
postfix::smtpd_tls_key_file: '/var/lib/dehydrated/certs/architux.com/privkey.pem'
postfix::smtpd_use_tls: 'yes'
postfix::smtpd_tls_session_cache_database: 'btree:${data_directory}/smtpd_scache'
postfix::smtp_tls_session_cache_database: 'btree:${data_directory}/smtp_scache'
postfix::smtpd_tls_loglevel: '1'
postfix::smtpd_tls_security_level: 'may'
postfix::smtpd_tls_received_header: 'yes'
postfix::smtpd_tls_session_cache_timeout: '3600s'
postfix::smtpd_tls_mandatory_protocols: 'SSLv2,!SSLv3'
postfix::postfix::smtp_tls_mandatory_protocols: 'SSLv2,!SSLv3'
postfix::smtpd_tls_protocols: 'SSLv2,!SSLv3'
postfix::smtp_tls_protocols: '!SSLv2,!SSLv3'
postfix::smtpd_tls_ciphers: 'high'
postfix::smtp_tls_mandatory_ciphers: 'high'
postfix::smtp_tls_mandatory_exclude_ciphers: 'RC4, MD5, DES'
postfix::smtp_tls_exclude_ciphers: 'aNULL, RC4, MD5, DES, 3DES'

postfix::enable_client_ssl: true
postfix::smtp_use_tls: 'yes'
postfix::smtp_tls_note_starttls_offer: 'yes'
postfix::smtp_tls_loglevel: '1'

postfix::enable_sasl: true
postfix::smtpd_sasl_local_domain: '$myhostname'
postfix::smtpd_sasl_auth_enable: 'yes'
postfix::broken_sasl_auth_clients: 'yes'
postfix::smtpd_sasl_authenticated_header: 'yes'

postfix::enable_ldap_alias: true
postfix::ldapaliases_server_host: 'localhost'
postfix::ldapaliases_search_base: 'ou=People,dc=architux,dc=com'
postfix::ldapaliases_scope: 'sub'
postfix::ldapaliases_query_filter: '(cn=%s)'
postfix::ldapaliases_result_attribute: 'mail'
postfix::alias_map: 'hash:/etc/aliases,ldap:ldapaliases'
postfix::sender_canonical_maps: 'hash:/etc/postfix/sender_canonical'
postfix::message_size_limit: '153600000'
postfix::milters: 
  - 'milter_protocol = 6'
  - 'milter_mail_macros = i {mail_addr} {client_addr} {client_name} {auth_authen}'
  - 'milter_default_action = accept'
postfix::smtpd_milters:
  - 'inet:localhost:9998,'
  - 'inet:localhost:11332'
postfix::non_smtpd_milters:
  - 'inet:localhost:8891'
postfix::smtpd_client_restrictions:
  - 'permit_mynetworks,'
  - 'permit_sasl_authenticated,'
  - 'check_client_access hash:/etc/postfix/client-access,'
  - 'reject_unknown_reverse_client_hostname'
postfix::smtpd_helo_restrictions:
  - 'permit_mynetworks,'
  - 'permit_sasl_authenticated,'
postfix::smtpd_sender_restrictions:
  - 'permit_mynetworks,'
  - 'permit_sasl_authenticated,'
  - 'reject_unauth_destination,'
  - 'check_sender_mx_access hash:/etc/postfix/sender-mx-access,'
  - 'check_sender_access regexp:/etc/postfix/sender-access,'
  - 'check_sender_ns_access hash:/etc/postfix/sender-ns-access'
postfix::smtpd_recipient_restrictions:
  - 'check_recipient_access hash:/etc/postfix/filtered_domains,'
  - 'permit_sasl_authenticated,'
  - 'permit_mynetworks,'
  - 'reject_unauth_destination,'
  - 'check_policy_service unix:private/policyd-spf'

postfix::header_checks: 'pcre:/etc/postfix/header_checks'
postfix::mime_header_checks: 'regexp:/etc/postfix/mime_header_checks'
postfix::enable_postscreen: true
postfix::postscreen_dnsbl_sites:
  - 'zen.spamhaus.org*3'
  - 'bl.spameatingmonkey.net*2'
  - 'dnsbl.ahbl.org'
  - 'bl.spamcop.net'
  - 'dnsbl.sorbs.net'  
postfix::mailbox_transport: 'lmtp:127.0.0.1:24'
postfix::enable_virtual_mailbox_domains:
postfix::virtual_mailbox_domains:
  - 'toto.com'
  - 'tata.com'
postfix::virtual_mailbox_base: '/var/spool/vmail'
postfix::virtual_mailbox_maps: 'hash:/etc/postfix/virtual'
postfix::virtual_alias_maps: 'hash:/etc/postfix/virtual_alias'
postfix::virtual_uid_maps: 'static:999'
postfix::virtual_gid_maps: 'static:999'
postfix::virtual_transport: 'lmtp:localhost:24'
